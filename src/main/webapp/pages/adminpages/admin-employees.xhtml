<!-- admin.xhtml -->
<ui:composition template="temp.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core">
    <ui:define name="title">Employees</ui:define>
    <ui:define name="main-content">
        <p:growl id="globalMessages" life="3000" globalOnly="true" showDetail="true" showSummary="true" skipDetailIfEqualsSummary="true"/>
        <h2>Employees</h2>
        <h4>Statistics</h4>
        <div class="stats">
            <p:panelGrid columns="3" styleClass="stats-grid" layout="grid">
                <p:panel header="Male" styleClass="stat-panel">
                    <h:outputText value="27" styleClass="stat-value"/>
                </p:panel>
                <p:panel header="Female" styleClass="stat-panel">
                    <h:outputText value="36" styleClass="stat-value"/>
                </p:panel>
                <p:panel header="M:F" styleClass="stat-panel">
                    <h:outputText value="3:4" styleClass="stat-value"/>
                </p:panel>
            </p:panelGrid>
        </div>
        <div class="bg-white pad1">
            <p:commandButton value="Add New" icon="pi pi-plus" styleClass="mr pill" onclick="PF('addUserDialog').show()" rendered="#{checkPermission.hasPermission('ADD_EMPLOYEE')}"/>
            <p:commandButton value="Delete All" icon="pi pi-trash" styleClass="bg-r pill" onclick="PF('deleteAllUsersDialog').show()" rendered="#{checkPermission.hasPermission('DELETE_EMPLOYEE')}"/>
        </div>

        <h:form id="usersDataTableForm">
            <div class="bg-white pad1">
                <p:inputText styleClass="pill fillW" value="" placeholder="Search">
                    <p:ajax event="keyup" delay="200" update="usersTable"/>
                </p:inputText>
            </div>
            <p:dataTable id="usersTable" value="#{getEmployees.retrieveAllEmployees()}" var="employee" paginator="true" rows="5">
                <p:column headerText="No">
                    <h:outputText value="#{getEmployees.retrieveAllEmployees().indexOf(employee) + 1}"/>
                </p:column>
                <p:column headerText="Firstname">
                    <h:outputText value="#{employee.firstname}"/>
                </p:column>
                <p:column headerText="username">
                    <h:outputText value="#{employee.username}"/>
                </p:column>
                <p:column headerText="Email">
                    <h:outputText value="#{employee.email}"/>
                </p:column>
                <p:column headerText="Role">
                    <h:outputText value="#{employee.role.name}"/>
                </p:column>
                <p:column headerText="Actions">
                    <p:commandButton title="Edit" action="#{updateEmployee.selectedUser(employee)}" icon="pi pi-pencil" styleClass="bg-g square pill mr" update="updateUserForm" onsuccess="PF('updateUserDialog').show()"/>
                    <p:commandButton title="Delete" action="#{deleteUser.selectedUser(employee)}" icon="pi pi-times" styleClass="bg-r square pill" update="deleteUserForm" onsuccess="PF('deleteUserDialog').show()"/>
                </p:column>
            </p:dataTable>

        </h:form>


        <p:dialog header="New User" widgetVar="addUserDialog" modal="true" resizable="false">
            <h:form id="addUserForm" styleClass="flex column">
                <p:panelGrid columns="3" layout="tabular">

                    <h:outputLabel for="firstname" value="First Name:" styleClass="label"/>
                    <p:inputText id="firstname" value="#{createEmployee.firstName}" required="true" styleClass="input">
                        <f:validateLength minimum="2" maximum="30"/>
                    </p:inputText>
                    <p:message for="firstname" styleClass="error"/>

                    <h:outputLabel for="lastname" value="Last Name:" styleClass="label"/>
                    <p:inputText id="lastname" value="#{createEmployee.lastName}" required="true" styleClass="input">
                        <f:validateLength minimum="2" maximum="30"/>
                    </p:inputText>
                    <p:message for="lastname" styleClass="error"/>

                    <h:outputLabel for="email" value="Email:" styleClass="label"/>
                    <p:inputText id="email" value="#{createEmployee.email}" required="true" styleClass="input">
                        <f:validateRegex pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" />
                    </p:inputText>
                    <p:message for="email" styleClass="error"/>

                    <h:outputLabel for="password" value="Password:" styleClass="label"/>
                    <p:password id="password" redisplay="true" value="#{createEmployee.password}" required="true" styleClass="input">
                        <f:validateLength minimum="6" maximum="20"/>
                    </p:password>
                    <p:message for="password" styleClass="error"/>

                    <h:outputLabel for="role" value="Role:" styleClass="label"/>
                    <p:selectOneMenu id="role" value="#{createEmployee.roleName}" required="true" styleClass="selectMenu">
                        <f:selectItems value="#{createEmployee.roles}" var="role" itemLabel="#{role.name}" itemValue="#{role.name}"/>
                    </p:selectOneMenu>
                    <p:message for="role" styleClass="error"/>

                    <h:outputLabel for="username" value="Username:" styleClass="label"/>
                    <p:inputText id="username" value="#{createEmployee.username}" required="true" styleClass="input">
                        <f:validateLength minimum="4" maximum="20"/>
                    </p:inputText>
                    <p:message for="username" styleClass="error"/>
                </p:panelGrid>

                <p:commandButton icon="pi pi-plus" value="Add User" action="#{createEmployee.createEmployee}" styleClass="pill" update="addUserForm globalMessages" oncomplete="if (!args.validationFailed) PF('addUserDialog').hide(); updateUsersTable();" />

<!--                <p:growl globalOnly="true" id="globalMessages"/>-->
            </h:form>
        </p:dialog>



        <p:dialog header="Update User" widgetVar="updateUserDialog" modal="true" resizable="false">
            <h:form id="updateUserForm" styleClass="flex column">
                <p:panelGrid columns="3" layout="tabular">

                    <h:outputLabel for="first_name" value="First Name:" styleClass="label"/>
                    <p:inputText id="first_name" value="#{updateEmployee.firstName}" required="true" styleClass="input">
                        <f:validateLength minimum="2" maximum="30"/>
                    </p:inputText>
                    <p:message for="first_name" styleClass="error"/>

                    <h:outputLabel for="last_name" value="Last Name:" styleClass="label"/>
                    <p:inputText id="last_name" value="#{updateEmployee.lastName}" required="true" styleClass="input">
                        <f:validateLength minimum="2" maximum="30"/>
                    </p:inputText>
                    <p:message for="last_name" styleClass="error"/>

                    <h:outputLabel for="emai_l" value="Email:" styleClass="label"/>
                    <p:inputText id="emai_l" value="#{updateEmployee.email}" required="true" styleClass="input">
                        <f:validateRegex pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" />
                    </p:inputText>
                    <p:message for="emai_l" styleClass="error"/>

                    <h:outputLabel for="pass_word" value="Password:" styleClass="label"/>
                    <p:password id="pass_word" redisplay="true" value="#{updateEmployee.password}" required="true" styleClass="input">
                        <f:validateLength minimum="6" maximum="20"/>
                    </p:password>
                    <p:message for="pass_word" styleClass="error"/>

                    <h:outputLabel for="ro_le" value="Role:" styleClass="label"/>
                    <p:selectOneMenu id="ro_le" value="#{updateEmployee.roleName}" required="true" styleClass="selectMenu">
                        <f:selectItems value="#{updateEmployee.roles}" var="role" itemLabel="#{role.name}" itemValue="#{role.name}"/>
                    </p:selectOneMenu>
                    <p:message for="ro_le" styleClass="error"/>

                    <h:outputLabel for="user_name" value="Username:" styleClass="label"/>
                    <p:inputText id="user_name" value="#{updateEmployee.username}" required="true" styleClass="input">
                        <f:validateLength minimum="4" maximum="20"/>
                    </p:inputText>
                    <p:message for="user_name" styleClass="error"/>
                </p:panelGrid>
                <p:commandButton icon="pi pi-save" value="Update User" action="#{updateEmployee.updateEmployee}" styleClass="pill" update="updateUserForm global_Messages" oncomplete="if (!args.validationFailed) PF('updateUserDialog').hide(); updateUsersTable()" />

                <p:growl globalOnly="true" id="global_Messages" />
            </h:form>
        </p:dialog>


        <p:dialog header="Delete User" widgetVar="deleteUserDialog" modal="true" resizable="false">
            <h:form id="deleteUserForm" styleClass="flex column">
                <h:outputText value="Delete the user '#{deleteUser.user.username}'?" styleClass="mb"/>
                <div class="flex row">
                    <p:commandButton value="Yes" icon="pi pi-trash" action="#{deleteUser.deleteUser}" update="globalM_essages" oncomplete="PF('deleteUserDialog').hide(); updateUsersTable();" styleClass="pill mr bg-r"/>
                    <p:commandButton value="No" icon="pi pi-times" onclick="PF('deleteUserDialog').hide()" type="button" styleClass="pill bg-g"/>
                </div>
                <p:messages globalOnly="true" id="globalM_essages"/>
            </h:form>
        </p:dialog>




        <p:dialog header="Delete All User" widgetVar="deleteAllUsersDialog" modal="true" resizable="false">
            <h:form id="deleteAllUsersForm" styleClass="flex column">
                <h:outputText value="Delete All users?" styleClass="mb"/>
                <div class="flex row">
                    <p:commandButton value="Yes" icon="pi pi-trash" action="#{deleteUser.deleteAllUsers}" update="globalM_es_sages" oncomplete="PF('deleteUserDialog').hide(); updateUsersTable();" styleClass="pill mr bg-r"/>
                    <p:commandButton value="No" icon="pi pi-times" onclick="PF('deleteAllUsersDialog').hide()" type="button" styleClass="pill bg-g"/>
                </div>
                <p:messages globalOnly="true" id="globalM_es_sages"/>
            </h:form>
        </p:dialog>



        <p:remoteCommand name="updateUsersTable" update=":usersDataTableForm:usersTable"/>


    </ui:define>
</ui:composition>