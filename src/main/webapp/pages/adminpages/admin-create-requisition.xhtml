<ui:composition template="temp.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pcs="http://java.sun.com/jsf/composite/pcs">
    <f:event type="preRenderView" listener="#{myRequisitionHandler.selectRequisition}"/>
    <ui:define name="title">My Requisitions</ui:define>
    <ui:define name="main-content">
        <p:tabView>
            <p:tab title="Current">
                <h2 class="mb">#{myRequisitionHandler.status.equals(null)?'Create':'Pending'} Requisition</h2>
                <h:form id="requisition_form" styleClass="pad2 mb flex column">
                    <p:panelGrid columns="2" layout="tabular">
                        <h:panelGroup class="flex column">
                            <p:outputLabel for="budgetline" value="Budget Line"/>
                            <p:selectOneMenu id="budgetline" value="#{myRequisitionHandler.budgetLineId}">
                                <f:selectItem value="#{null}" itemDisabled="true" itemLabel="Choose Budgetline" />
                                <f:selectItems value="#{myRequisitionHandler.budgetLines}" var="budgetline" itemValue="#{budgetline.id}" itemLabel="#{budgetline.description}"/>
                            </p:selectOneMenu>
                        </h:panelGroup>
                        <h:panelGroup class="flex column">
                            <p:outputLabel for="amount" value="Amount"/>
                            <p:inputNumber id="amount" value="#{myRequisitionHandler.requestedAmount}"/>
                        </h:panelGroup>
                        <h:panelGroup class="flex column">
                            <p:outputLabel for="status" value="Status"/>
                            <p:inputText id="status" placeholder="Status" readonly="true" value="#{myRequisitionHandler.status}"/>
                        </h:panelGroup>
                        <h:panelGroup class="flex column">
                            <p:outputLabel for="date_needed" value="Date Needed"/>
                            <p:calendar id="date_needed" mindate="c" placeholder="Date Needed" value="#{myRequisitionHandler.maxDate}"/>
                        </h:panelGroup>
                        <h:panelGroup class="flex column">
                            <p:outputLabel for="justification" value="Justification"/>
                            <p:inputTextarea id="justification" placeholder="Description..." value="#{myRequisitionHandler.justification}"/>
                        </h:panelGroup>
                        <h:panelGroup class="flex column" rendered="#{myRequisitionHandler.status.equals('Approved') or myRequisitionHandler.status.equals('Paid')}">
                            <p:outputLabel for="amountGranted" value="Amount Granted"/>
                            <p:inputTextarea id="amountGranted" value="#{myRequisitionHandler.amountGranted}"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <div>
                        <h:outputText value="Your Requisition is currently in review. Please check back later."
                                      rendered="#{myRequisitionHandler.status.equals('Pending')}"/>
                        <h:outputText value="Your Requisition has been Approved. Please wait a small while for the money to reach you."
                                      rendered="#{myRequisitionHandler.status.equals('Approved')}"/>
                        <p:commandButton value="Submit" icon="pi pi-check" styleClass="mt pill" actionListener="#{myRequisitionHandler.updateRequisition}"
                                         update="globalMessages requisition_form" rendered="#{myRequisitionHandler.status.equals(null) or myRequisitionHandler.status.length() lt 1}"/>
                        <p:messages globalOnly="true" id="globalMessages"/>
                    </div>
                </h:form>
                <h:panelGroup rendered="#{myRequisitionHandler.status.equals('Paid')}" styleClass="mt pad2">
                    <h3 class="mb">Accountability</h3>
                    <h:form styleClass="flex column pad2">
                        <h:panelGroup styleClass="flex row pad1">
                            <h:panelGroup styleClass="flex column fillW">
                                <p:outputLabel for="ac_amt_used" value="Amount Used" styleClass="mt"/>
                                <p:inputNumber id="ac_amt_used" styleClass="mb mt" value="#{createAccountability.amountSpent}" required="true"/>
                            </h:panelGroup>
                            <h:panelGroup styleClass="flex column fillW">
                                <p:outputLabel for="ac_description" value="Description" styleClass="mt"/>
                                <p:inputTextarea id="ac_description" styleClass="mb mt" value="#{createAccountability.description}"/>
                            </h:panelGroup>
                        </h:panelGroup>
                        <div>
                            <p:panel header="Upload Image">
                                <p:fileUpload listener="#{createAccountability.handleFileUpload}" mode="simple" auto="true" update="imagePreview messages" />
                                <p:messages globalOnly="true" id="messages" />
                                <p:graphicImage id="imagePreview" value="#{createAccountability.imageStream}" width="100" height="100"/>
                            </p:panel>
                        </div>

                        <div>
                            <p:commandButton value="Submit Accountability" icon="pi pi-upload" action="#{createAccountability.save}" styleClass="mt pill"/>
                        </div>
                    </h:form>
                </h:panelGroup>
            </p:tab>
            <p:tab title="History">

                <h:form>
                    <p:tabView id="mtabView" activeIndex="#{myRequisitions.activeTab}">
                        <p:ajax event="tabChange" listener="#{myRequisitions.onTabChange}" update="j_idt24:history_form"/>
                        <p:tab id="completedTab" title="COMPLETED"/>
                        <p:tab id="rejectedTab" title="REJECTED"/>
                        <p:tab id="expiredTab" title="EXPIRED"/>
                    </p:tabView>
                </h:form>


                <h:form id="history_form">
                    <p:dataTable id="my_requisition_table" paginator="true" rows="5" rowsPerPageTemplate="5,10,15" value="#{myRequisitions.requisitionsForActiveTab}" var="requisition">
                        <p:column headerText="No." width="12px">
                            #{loginBean.loggedInUser.requisition.indexOf(requisition) + 1}
                        </p:column>
                        <p:column headerText="Description">
                            #{requisition.justification}
                        </p:column>
                        <p:column headerText="Status">
                            #{requisition.status}
                        </p:column>
                        <p:column headerText="Requested">
                            #{requisition.estimatedAmount}
                        </p:column>
                        <p:column headerText="Granted">
                            #{requisition.amountGranted}
                        </p:column>
                        <p:column headerText="Budget Line">
                            #{requisition.budgetline.description}
                        </p:column>
                        <p:column headerText="Date Approved" rendered="#{requisition.status.equals('Approved')}">
                            #{requisition.dateApproved}
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:tab>
        </p:tabView>
    </ui:define>
</ui:composition>



